generator client {
    provider     = "prisma-client"
    output       = "../prisma/generated"
    moduleFormat = "cjs"
}

datasource db {
    provider = "postgresql"
}

model CartItem {
    id          String @id @default(uuid()) @db.Uuid
    customer_id String @db.Text

    // Mutable fields
    amount Int @db.Integer

    // Foreign keys
    menu_item_id String @db.Uuid

    // Back relation fields
    menu_item MenuItem @relation(fields: [menu_item_id], onDelete: Cascade, references: [id])

    // Constraints
    @@unique([customer_id, menu_item_id])
}

model MenuItem {
    id         String   @id @default(uuid()) @db.Uuid
    category   Category
    created_at DateTime @default(now())

    // Mutable fields
    available   Boolean        @default(true)
    description String         @db.VarChar(500)
    image       String         @db.Text
    name        String         @db.VarChar(50)
    prep_time   Int            @db.Integer
    price       Float          @db.DoublePrecision
    status      MenuItemStatus @default(KEPT_AS_DRAFT)
    updated_at  DateTime       @updatedAt

    // Foreign keys
    restaurant_id String @db.Text

    // Front relation fields
    cart_items    CartItem[]
    ordered_items OrderedItem[]

    // Back relation fields
    restaurant Restaurant @relation(fields: [restaurant_id], onDelete: Cascade, references: [id])
}

model Order {
    id          String    @id @default(uuid()) @db.Uuid
    created_at  DateTime  @default(now())
    customer_id String?   @db.Text
    rider_id    String?   @db.Text
    total_price Float     @db.DoublePrecision
    type        OrderType

    // Mutable fields
    status     OrderStatus @default(PENDING)
    updated_at DateTime    @updatedAt

    // Foreign keys
    restaurant_id String? @db.Text

    // Front relation fields
    ordered_items OrderedItem[]

    // Back relation fields
    restaurant Restaurant? @relation(fields: [restaurant_id], onDelete: SetNull, references: [id])
}

model OrderedItem {
    id             String @id @default(uuid()) @db.Uuid
    amount         Int    @db.Integer
    price_per_item Float  @db.DoublePrecision

    // Foreign keys
    menu_item_id String? @db.Uuid
    order_id     String  @db.Uuid

    // Back relation fields
    menu_item MenuItem? @relation(fields: [menu_item_id], onDelete: SetNull, references: [id])
    order     Order     @relation(fields: [order_id], references: [id])
}

model Restaurant {
    id String @id @db.Text

    // Mutable fields
    name String   @db.Text
    tags String[] @default([])

    // Front relation fields
    menuItems MenuItem[]
    orders    Order[]
}

enum Category {
    DISH
    DRINK
}

enum OrderType {
    DELIVERY
    PICKUP
}

enum MenuItemStatus {
    APPROVED
    KEPT_AS_DRAFT
    PENDING_APPROVAL
    DENIED
}

enum OrderStatus {
    CANCELLED // customer - before pickup
    PENDING
    REJECTED // restaurant
    ACCEPTED // restaurant
    PREPARING // restaurant
    READY_FOR_PICKUP // restaurant
    PICKED_UP // rider
    RETURNED // rider
    IN_TRANSIT // rider
    FAILED
    DELIVERED // restaurant if type is PICKUP | rider if type is DELIVERY
}
