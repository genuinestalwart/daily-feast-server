generator client {
    provider     = "prisma-client"
    output       = "../prisma/generated"
    moduleFormat = "cjs"
}

datasource db {
    provider = "postgresql"
}

model CartItem {
    id             String @id @default(uuid()) @db.Uuid
    customer_id    String @db.Text
    price_per_item Float  @db.DoublePrecision

    // Mutable fields
    amount Int @db.Integer

    // Foreign keys
    menu_item_id String @db.Uuid

    // Back relation fields
    menu_item MenuItem @relation(fields: [menu_item_id], onDelete: Cascade, references: [id])
}

model MenuItem {
    id            String   @id @default(uuid()) @db.Uuid
    category      Category
    created_at    DateTime @default(now())
    restaurant_id String   @db.Text

    // Mutable fields
    available   Boolean        @default(true)
    description String         @db.VarChar(500)
    image       String         @db.Text
    name        String         @db.VarChar(50)
    prep_time   Int            @db.Integer
    price       Float          @db.DoublePrecision
    status      MenuItemStatus @default(KEPT_AS_DRAFT)
    tags        String[]
    updated_at  DateTime       @updatedAt

    // Front relation fields
    cart_items    CartItem[]
    ordered_items OrderedItem[]
}

model Order {
    id            String    @id @default(uuid()) @db.Uuid
    created_at    DateTime  @default(now())
    customer_id   String?   @db.Text
    restaurant_id String?   @db.Text
    rider_id      String?   @db.Text
    type          OrderType
    total_price   Float     @db.DoublePrecision

    // Mutable fields
    status     OrderStatus @default(PENDING)
    updated_at DateTime    @updatedAt

    // Front relation fields
    ordered_items OrderedItem[]
}

model OrderedItem {
    id             String @id @default(uuid()) @db.Uuid
    amount         Int    @db.Integer
    price_per_item Float  @db.DoublePrecision

    // Foreign keys
    menu_item_id String? @db.Uuid
    order_id     String  @db.Uuid

    // Back relation fields
    menu_item MenuItem? @relation(fields: [menu_item_id], onDelete: SetNull, references: [id])
    order     Order     @relation(fields: [order_id], references: [id])
}

enum Category {
    DISH
    DRINK
}

enum OrderType {
    DELIVERY
    PICKUP
}

enum MenuItemStatus {
    APPROVED
    KEPT_AS_DRAFT
    PENDING_APPROVAL
    DENIED
}

enum OrderStatus {
    CANCELLED // customer - before pickup
    PENDING
    REJECTED // restaurant
    ACCEPTED // restaurant
    PREPARING // restaurant
    READY_FOR_PICKUP // restaurant
    PICKED_UP // rider
    RETURNED // rider
    IN_TRANSIT // rider
    FAILED
    DELIVERED // rider
}
